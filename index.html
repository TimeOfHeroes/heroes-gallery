<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>–ì–∞–ª–µ—Ä–µ—è –≥–µ—Ä–æ–µ–≤ ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
:root { 
  color-scheme: light dark; 
  --hdrH: 64px; 
  --primary-color: #0a7;
  --secondary-color: #f3f3f3;
  --border-color: #ddd;
}
* { box-sizing: border-box; }
body { 
  margin:0; 
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
  background:#f7f7f7; 
  color:#111;
  line-height: 1.4;
}
header { 
  position: sticky; 
  top: 0; 
  z-index: 100; 
  background: rgba(255,255,255,.98); 
  backdrop-filter: blur(8px); 
  border-bottom: 1px solid var(--border-color);
  box-shadow: 0 2px 10px rgba(0,0,0,.05);
}
.bar { 
  display:flex; 
  gap:12px; 
  align-items:center; 
  padding:12px 16px; 
  flex-wrap:wrap;
  max-width: 1400px;
  margin: 0 auto;
}
h1 { 
  margin:0; 
  font-size:20px; 
  font-weight: 600;
  color: #333;
}
.grow { 
  flex: 1 1 240px; 
  display:flex; 
  gap:8px; 
  align-items:center; 
}
.bar input[type="search"], .bar select, .bar button { 
  font-size:14px; 
  padding:8px 12px; 
  border: 1px solid #ccc;
  border-radius: 8px;
  background: white;
  transition: all 0.2s;
}
.bar input[type="search"]:focus, .bar select:focus { 
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 2px rgba(10, 119, 0, 0.1);
}
.btn { 
  border:1px solid #ccc; 
  background:#fff; 
  border-radius:8px; 
  cursor:pointer;
  transition: all 0.2s;
  font-weight: 500;
}
.btn:hover {
  background: #f5f5f5;
  border-color: #999;
  transform: translateY(-1px);
}
.btn.primary { 
  background:var(--primary-color); 
  color:#fff; 
  border-color:var(--primary-color); 
}
.btn.primary:hover {
  background: #098;
  border-color: #098;
}

/* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
.wrap { 
  display:block; 
  padding:20px; 
  min-height: calc(100vh - var(--hdrH));
  max-width: 1400px;
  margin: 0 auto;
}
@media (max-width: 1024px) { 
  .wrap { 
    padding: 16px;
    min-height: auto;
  } 
}

/* –§–∏–ª—å—Ç—Ä—ã - –ò–°–ü–†–ê–í–õ–ï–ù–´ –¶–í–ï–¢–ê */
.filters { 
  background:#fff; 
  border:1px solid #e5e5e5; 
  border-radius:12px;
  box-shadow: 0 2px 10px rgba(0,0,0,.05);
  width: 320px;
}
.filters .panel { 
  padding:16px; 
  background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –±–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è –≤—Å–µ–π –ø–∞–Ω–µ–ª–∏ */
}
.filters .head { 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  margin-bottom:16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #eee;
  background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –±–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
}
.filters h2 { 
  margin:0; 
  font-size:18px; 
  font-weight: 600;
  color: #333;
}
.facet { 
  margin-bottom:20px; 
  background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –±–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ */
  padding: 0; /* –£–±—Ä–∞–Ω—ã –æ—Ç—Å—Ç—É–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ä—ã–π —Ñ–æ–Ω */
}
.facet h3 { 
  margin:0 0 10px; 
  font-size:15px; 
  color:#333;
  font-weight: 500;
  background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –±–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
  padding: 0; /* –£–±—Ä–∞–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
}
.opts { 
  max-height:200px; 
  overflow-y: auto;
  overflow-x: hidden;
  border:1px solid #eee; 
  border-radius:8px; 
  padding:8px; 
  background:#fafafa; 
}
.opt { 
  display:flex; 
  align-items:center; 
  gap:8px; 
  margin-bottom:6px; 
  font-size:14px; 
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 4px;
  transition: background 0.2s;
  background: transparent; /* –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
}
.opt:hover {
  background: #f0f0f0;
}
.opt input[type="checkbox"] { 
  width: 18px; 
  height: 18px; 
  cursor: pointer; 
  flex-shrink: 0;
}
.facet .actions { 
  display:flex; 
  gap:8px; 
  margin-top:10px; 
  background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: –±–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
}
.facet .actions .btn { 
  font-size:13px; 
  padding:6px 10px; 
}

/* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
@media (min-width: 1025px) {
  .filters { 
    position: fixed;
    top: var(--hdrH);
    left: 0;
    bottom: 0;
    width: 320px;
    max-height: calc(100vh - var(--hdrH));
    overflow: auto;
    z-index: 99;
    border-radius: 0 12px 12px 0;
    box-shadow: 2px 0 15px rgba(0,0,0,.1);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    background: #fff; /* –î–æ–±–∞–≤–ª–µ–Ω–æ: —è–≤–Ω—ã–π –±–µ–ª—ã–π —Ñ–æ–Ω */
  }
  .filters.show {
    transform: translateX(0);
  }
  #openFilters { 
    display: inline-block !important;
  }
}

/* –ú–æ–±–∏–ª—å–Ω—ã–π –æ—Ñ—Ñ–∫–∞–Ω–≤–∞—Å - –ò–°–ü–†–ê–í–õ–ï–ù–´ –ì–†–ê–ù–ò–¶–´ */
@media (max-width: 1024px) {
  .filters { 
    position: fixed; 
    inset: 0; 
    background: rgba(0,0,0,.6); 
    display:none; 
    z-index:1000; 
    border:none; 
    padding: 0;
    margin: 0;
    width: 100vw;
    height: 100vh;
  }
  .filters.show { 
    display:block; 
  }
  .filters .panel { 
    position:absolute; 
    right:0; 
    top:0; 
    bottom:0; 
    width: min(380px, 90vw); /* –£–º–µ–Ω—å—à–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
    max-width: 90vw; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
    overflow:auto; 
    background:#fff; 
    border-radius:12px 0 0 12px;
    padding: 20px;
    box-sizing: border-box;
    margin: 0;
    box-shadow: -2px 0 15px rgba(0,0,0,.1);
  }
  .filters .head { 
    position: sticky; 
    top:0; 
    background:#fff; 
    padding-top:12px; 
    z-index:1;
    padding-bottom: 12px;
    margin: 0;
  }
  #openFilters { 
    display: inline-block; 
  }
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width: 380px) {
  .filters .panel {
    width: 95vw;
    max-width: 95vw;
    padding: 16px;
  }
}

/* –ö–æ–Ω—Ç–µ–Ω—Ç –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.content { 
  min-height:60vh; 
  width: 100%;
}
#count { 
  margin:0 0 20px; 
  color:#666; 
  font-size:15px;
  padding: 8px 0;
  font-weight: 500;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
.cards { 
  display:grid; 
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
  gap:20px; 
  width: 100%;
}

/* –î–µ—Å–∫—Ç–æ–ø - –±–æ–ª—å—à–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Ä—è–¥ */
@media (min-width: 1025px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
    gap:20px;
  }
}

/* –ë–æ–ª—å—à–∏–µ —ç–∫—Ä–∞–Ω—ã */
@media (min-width: 1400px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
  }
}

@media (max-width: 1024px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
    gap:16px;
  }
}

@media (max-width: 768px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
    gap:14px;
  }
}

@media (max-width: 640px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
    gap:12px;
  }
}

@media (max-width: 480px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
    gap:10px;
  }
}

@media (max-width: 360px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
    gap:8px;
  }
}

.card { 
  border:1px solid #ddd; 
  border-radius:12px; 
  overflow:hidden; 
  background:#fff; 
  display:flex; 
  flex-direction:column; 
  transition: all 0.3s ease; 
  cursor:pointer;
  height: 100%;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}
.card:hover { 
  box-shadow:0 8px 25px rgba(0,0,0,.12); 
  transform: translateY(-4px);
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ */
.thumb { 
  width:100%; 
  height: 190px;
  background:#f5f5f5; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  overflow:hidden;
  position: relative;
}
.thumb img { 
  width: 100%;
  height: 100%;
  object-fit: contain;
  padding: 12px;
  transition: transform 0.3s;
}
.card:hover .thumb img {
  transform: scale(1.05);
}

@media (max-width: 768px) {
  .thumb { 
    height: 160px;
  }
}

@media (max-width: 480px) {
  .thumb { 
    height: 140px;
  }
}

.card h3 { 
  margin:12px 12px 6px; 
  font-size:16px; 
  font-weight: 600;
  line-height: 1.3;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: center;
  color: #333;
}

.meta { 
  margin:0 12px 6px; 
  color:#555; 
  display:flex; 
  gap:6px; 
  flex-wrap:wrap; 
  font-size:13px;
  line-height: 1.4;
  justify-content: center;
  text-align: center;
}
.stats { 
  margin:0 12px 12px; 
  display:flex; 
  gap:6px; 
  flex-wrap:wrap;
  justify-content: center;
}
.pill { 
  background:#f3f3f3; 
  border:1px solid #e6e6e6; 
  border-radius:999px; 
  padding:4px 8px; 
  font-size:12px;
  white-space: nowrap;
  font-weight: 500;
}

/* –ú–æ–¥–∞–ª–∫–∞ */
.modal { 
  position: fixed; 
  inset: 0; 
  background: rgba(0,0,0,.85); 
  display: none; 
  align-items: center; 
  justify-content: center; 
  padding: 20px; 
  z-index: 2000; 
}
.modal.show { 
  display: flex; 
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
.dialog { 
  position: relative; 
  background: #fff; 
  color: #111; 
  max-width: 1000px; 
  width: min(1000px, 95vw); 
  max-height: 90vh; 
  overflow: hidden; 
  border-radius: 16px; 
  box-shadow: 0 25px 50px rgba(0,0,0,.3); 
  display: flex; 
  flex-direction: column;
}
.dialog .modal-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  padding: 24px;
  overflow-y: auto;
  max-height: calc(90vh - 60px);
}
.dialog .image-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.dialog img { 
  width: 100%;
  height: auto;
  max-height: 350px;
  object-fit: contain;
  border-radius: 12px;
  background: #f5f5f5;
  padding: 15px;
}
.dialog .info-container {
  display: flex;
  flex-direction: column;
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
}
.dialog h2 { 
  margin: 0 0 12px; 
  font-size:28px; 
  font-weight: 700;
  color: #222;
  line-height: 1.2;
}
.dialog .meta { 
  display:flex; 
  gap:10px; 
  flex-wrap:wrap; 
  color:#555; 
  margin-bottom:10px; 
  font-size:15px;
  justify-content: flex-start;
}
.dialog .mStats { 
  display:flex; 
  gap:10px; 
  flex-wrap:wrap; 
  margin:12px 0 20px;
}
.dialog .mStats .pill { 
  font-size:14px; 
  padding:8px 12px;
  background: #e8f5e8;
  border-color: var(--primary-color);
  color: #0a5;
}
.pre { 
  white-space: pre-line; 
  background:#fafafa; 
  border:1px solid #eee; 
  border-radius:10px; 
  padding:12px; 
  font-size:15px; 
  overflow-wrap: break-word;
  word-break: break-word;
  line-height: 1.5;
  margin: 8px 0;
}
.close { 
  position: absolute; 
  top: 12px; 
  right: 12px; 
  border: none; 
  background: rgba(0,0,0,.7); 
  color: #fff; 
  font-size: 24px; 
  line-height: 1; 
  width: 40px;
  height: 40px;
  border-radius: 50%; 
  cursor: pointer; 
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.close:hover {
  background: rgba(0,0,0,.9);
  transform: scale(1.1);
}
.nav { 
  position: absolute; 
  top: 50%; 
  transform: translateY(-50%); 
  border: none; 
  background: rgba(0,0,0,.7); 
  color: #fff; 
  font-size: 28px; 
  line-height: 1; 
  width: 44px;
  height: 44px;
  padding: 0;
  border-radius: 50%; 
  cursor: pointer; 
  z-index: 10; 
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.nav:hover {
  background: rgba(0,0,0,.9);
  transform: translateY(-50%) scale(1.1);
}
.nav.prev { left: 12px; } 
.nav.next { right: 12px; }
.all-fields { 
  margin-top: 20px; 
  border-top: 1px solid #eee; 
  padding-top: 16px; 
}
.all-fields h3 {
  margin: 0 0 12px;
  font-size: 18px;
  color: #333;
}
.all-fields table { 
  width:100%; 
  border-collapse: collapse; 
}
.all-fields th, .all-fields td { 
  text-align:left; 
  vertical-align: top; 
  padding:8px 12px; 
  border-bottom:1px solid #f0f0f0; 
  font-size:14px;
  line-height: 1.4;
}
.all-fields th { 
  width: 35%; 
  color:#444;
  font-weight: 500;
  white-space: nowrap;
}
.all-fields td {
  word-break: break-word;
  max-width: 0;
  overflow-wrap: break-word;
}
.open-img { 
  margin-top:12px; 
  display:inline-block; 
  font-size:14px; 
  color:var(--primary-color); 
  text-decoration:none;
  font-weight: 500;
  transition: color 0.2s;
}
.open-img:hover {
  color: #098;
  text-decoration: underline;
}

@media (max-width: 860px) { 
  .dialog .modal-content { 
    grid-template-columns: 1fr; 
    padding: 20px;
    gap: 20px;
  }
  .dialog img { 
    max-height: 280px;
  }
  .dialog h2 {
    font-size: 24px;
  }
}

@media (max-width: 480px) {
  .dialog {
    width: 95vw;
    max-height: 95vh;
  }
  .dialog .modal-content { 
    padding: 16px;
    gap: 16px;
  }
  .dialog h2 { 
    font-size: 22px;
  }
  .dialog .meta {
    font-size: 14px;
  }
  .close {
    top: 8px;
    right: 8px;
    width: 36px;
    height: 36px;
    font-size: 20px;
  }
  .nav {
    width: 36px;
    height: 36px;
    font-size: 22px;
  }
}

/* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
#empty { 
  display:none; 
  color:#666; 
  padding:40px 24px; 
  text-align: center;
  grid-column: 1 / -1;
  font-size: 16px;
}
#empty:before {
  content: "üòï";
  display: block;
  font-size: 48px;
  margin-bottom: 16px;
}

/* –ö–Ω–æ–ø–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
.info-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary-color);
  color: white;
  border: none;
  font-size: 24px;
  cursor: pointer;
  z-index: 90;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 15px rgba(10, 119, 0, 0.3);
  transition: all 0.3s;
}
.info-btn:hover {
  background: #098;
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(10, 119, 0, 0.4);
}

.info-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 2001;
}
.info-modal.show {
  display: flex;
}
.info-dialog {
  background: white;
  border-radius: 16px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 20px 60px rgba(0,0,0,.3);
  position: relative;
}
.info-dialog h2 {
  margin: 0 0 20px;
  color: #333;
  font-size: 24px;
  text-align: center;
}
.info-dialog p {
  margin: 0 0 15px;
  line-height: 1.6;
  color: #555;
}
.info-dialog .clan {
  background: #e8f5e8;
  padding: 15px;
  border-radius: 10px;
  margin: 20px 0;
  text-align: center;
  border: 1px solid var(--primary-color);
}
.info-dialog .clan strong {
  color: var(--primary-color);
  font-size: 18px;
}
.info-dialog .date {
  text-align: center;
  font-style: italic;
  color: #888;
  margin-top: 20px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}
.info-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #999;
  transition: color 0.2s;
}
.info-close:hover {
  color: #333;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width: 320px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); 
    gap:10px;
  }
  .thumb { 
    height: 120px;
  }
  .card h3 {
    font-size: 14px;
  }
  .meta, .pill {
    font-size: 11px;
  }
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
@media (min-width: 769px) and (max-width: 1024px) {
  .cards { 
    grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); 
    gap:18px;
  }
  .thumb { 
    height: 180px;
  }
}

/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ö –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
.filters.show::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.6);
  z-index: -1;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —à–∞–ø–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
  .bar {
    gap: 10px;
    padding: 10px;
  }
  h1 {
    font-size: 18px;
  }
  .bar input[type="search"], .bar select, .bar button {
    font-size: 13px;
    padding: 7px 10px;
  }
  .info-btn {
    bottom: 15px;
    right: 15px;
    width: 44px;
    height: 44px;
    font-size: 20px;
  }
}

/* –ü–æ–¥–ª–æ–∂–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ö –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
@media (min-width: 1025px) {
  .filters.show ~ .wrap::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.5);
    z-index: 98;
    pointer-events: none;
  }
}
</style>
</head>
<body>
<header>
<div class="bar">
<h1>–ì–∞–ª–µ—Ä–µ—è –≥–µ—Ä–æ–µ–≤</h1>
<div class="grow">
<input id="q" type="search" class="btn" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º">
</div>
<select id="sortBy" class="btn" title="–ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏">
<option value="–°–∏–ª–∞" selected>–°–∏–ª–∞</option>
<option value="–ê—Ç–∞–∫–∞">–ê—Ç–∞–∫–∞</option>
<option value="–ó–∞—â–∏—Ç–∞">–ó–∞—â–∏—Ç–∞</option>
<option value="–ñ–∏–∑–Ω–∏">–ñ–∏–∑–Ω–∏</option>
<option value="–ì–µ—Ä–æ–π">–ò–º—è</option>
</select>
<select id="sortDir" class="btn" title="–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
<option value="desc" selected>–£–±—ã–≤.</option>
<option value="asc">–í–æ–∑—Ä.</option>
</select>
<button id="openFilters" class="btn">–§–∏–ª—å—Ç—Ä—ã</button>
<button id="resetAll" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
</div>
</header>

<!-- –§–∏–ª—å—Ç—Ä—ã (—Å–∫—Ä—ã—Ç–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö) -->
<aside id="filters" class="filters" aria-hidden="true">
<div class="panel">
<div class="head">
<h2>–§–∏–ª—å—Ç—Ä—ã</h2>
<button id="closeFilters" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
<div class="facet" data-facet="element">
      <h3>–°—Ç–∏—Ö–∏—è</h3>
      <div class="opts" id="facet-element"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="element">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="element">–°–Ω—è—Ç—å</button>
      </div>
    </div>

    <div class="facet" data-facet="stars">
      <h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥</h3>
      <div class="opts" id="facet-stars"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="stars">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="stars">–°–Ω—è—Ç—å</button>
      </div>
    </div>

    <div class="facet" data-facet="mana">
      <h3>–°–∫–æ—Ä–æ—Å—Ç—å –º–∞–Ω—ã</h3>
      <div class="opts" id="facet-mana"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="mana">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="mana">–°–Ω—è—Ç—å</button>
      </div>
    </div>

    <div class="facet" data-facet="attackType">
      <h3>–°–ø–æ—Å–æ–± –∞—Ç–∞–∫–∏</h3>
      <div class="opts" id="facet-attackType"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="attackType">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="attackType">–°–Ω—è—Ç—å</button>
      </div>
    </div>

    <div class="facet" data-facet="summon">
      <h3>–ú–µ—Å—Ç–æ –ø—Ä–∏–∑—ã–≤–∞</h3>
      <div class="opts" id="facet-summon"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="summon">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="summon">–°–Ω—è—Ç—å</button>
      </div>
    </div>

    <div class="facet" data-facet="clazz">
      <h3>–ö–ª–∞—Å—Å</h3>
      <div class="opts" id="facet-clazz"></div>
      <div class="actions">
        <button class="btn" data-action="all" data-facet="clazz">–í—Å–µ</button>
        <button class="btn" data-action="none" data-facet="clazz">–°–Ω—è—Ç—å</button>
      </div>
    </div>
  </div>
</aside>

<div class="wrap">
<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
<section class="content">
  <div id="count">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <div id="cards" class="cards"></div>
  <div id="empty" style="display:none; color:#666; padding:24px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã.</div>
</section>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
<div class="dialog">
<button id="mClose" class="close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
<button id="mPrev" class="nav prev" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π">‚Äπ</button>
<button id="mNext" class="nav next" aria-label="–°–ª–µ–¥—É—é—â–∏–π">‚Ä∫</button>
<div class="modal-content">
  <div class="image-container">
    <img id="mImg" src="" alt="">
    <a id="mOpenImg" class="open-img" href="#" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</a>
  </div>
  <div class="info-container">
    <h2 id="mName"></h2>
    <div id="mMeta1" class="meta"></div>
    <div id="mMeta2" class="meta"></div>
    <div id="mStats" class="mStats"></div>
    <h3>–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</h3>
    <div id="mAbilities" class="pre"></div>
    <h3>–ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</h3>
    <div id="mPassive" class="pre"></div>
    <div class="all-fields">
      <h3>–í—Å–µ –ø–æ–ª—è</h3>
      <table id="mAllFields"></table>
    </div>
  </div>
</div>
</div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div id="infoModal" class="info-modal">
  <div class="info-dialog">
    <button id="infoClose" class="info-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
    <h2>–û –≥–∞–ª–µ—Ä–µ–µ –≥–µ—Ä–æ–µ–≤</h2>
    <p>–≠—Ç–∞ –≥–∞–ª–µ—Ä–µ—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–µ—Ä–æ—è—Ö –∏–≥—Ä—ã, –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö.</p>
    <div class="clan">
      <strong>–ê–≤—Ç–æ—Ä—ã:</strong><br>
      –ï–≤–≥–µ–Ω–∏–π –ü–æ—Ç–∞—à–∫–æ –∏ –í–ª–∞–¥–∏–º–∏—Ä –ü–ª–æ—Ç–Ω–∏–∫–æ–≤<br>
      <strong>–ö–ª–∞–Ω: "–†–æ–∂–¥–µ–Ω–Ω—ã–µ –≤ –°–°–°–†."</strong>
    </div>
    <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º –Ω–æ–≤—ã—Ö –≥–µ—Ä–æ–µ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–ª–∞–Ω—Å–µ –∏–≥—Ä—ã.</p>
    <p class="date">–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: <span id="updateDate"></span></p>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<button id="infoBtn" class="info-btn" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">i</button>

<script>
// –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ (—Ç–æ—á–Ω–æ –∫–∞–∫ –≤ CSV)
const F = {
id: 'id',
name: '–ì–µ—Ä–æ–π',
element: '–°—Ç–∏—Ö–∏—è',
stars: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥',
mana: '–°–∫–æ—Ä–æ—Å—Ç—å –º–∞–Ω—ã',
power: '–°–∏–ª–∞',
attack: '–ê—Ç–∞–∫–∞',
defense: '–ó–∞—â–∏—Ç–∞',
hp: '–ñ–∏–∑–Ω–∏',
attackType: '–°–ø–æ—Å–æ–± –∞—Ç–∞–∫–∏',
abilities: '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏',
passive: '–ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏',
summon: '–ú–µ—Å—Ç–æ –ø—Ä–∏–∑—ã–≤–∞',
clazz: '–ö–ª–∞—Å—Å',
image: '–ö–∞—Ä—Ç–∏–Ω–∫–∞'
};
const DATA_URL = 'heroes.csv?ts=' + Date.now();

const els = {
  q: document.getElementById('q'),
  sortBy: document.getElementById('sortBy'),
  sortDir: document.getElementById('sortDir'),
  resetAll: document.getElementById('resetAll'),
  openFilters: document.getElementById('openFilters'),
  closeFilters: document.getElementById('closeFilters'),
  filters: document.getElementById('filters'),
  count: document.getElementById('count'),
  cards: document.getElementById('cards'),
  empty: document.getElementById('empty'),
  facet: {
    element: document.getElementById('facet-element'),
    stars: document.getElementById('facet-stars'),
    mana: document.getElementById('facet-mana'),
    attackType: document.getElementById('facet-attackType'),
    summon: document.getElementById('facet-summon'),
    clazz: document.getElementById('facet-clazz'),
  },
  modal: document.getElementById('modal'),
  mClose: document.getElementById('mClose'),
  mPrev: document.getElementById('mPrev'),
  mNext: document.getElementById('mNext'),
  mImg: document.getElementById('mImg'),
  mOpenImg: document.getElementById('mOpenImg'),
  mName: document.getElementById('mName'),
  mMeta1: document.getElementById('mMeta1'),
  mMeta2: document.getElementById('mMeta2'),
  mStats: document.getElementById('mStats'),
  mAbilities: document.getElementById('mAbilities'),
  mPassive: document.getElementById('mPassive'),
  mAllFields: document.getElementById('mAllFields'),
  infoModal: document.getElementById('infoModal'),
  infoBtn: document.getElementById('infoBtn'),
  infoClose: document.getElementById('infoClose'),
  updateDate: document.getElementById('updateDate')
};

let allRows = [];
let viewRows = [];
let currentIdx = -1;

const selected = {
  element: new Set(),
  stars: new Set(),
  mana: new Set(),
  attackType: new Set(),
  summon: new Set(),
  clazz: new Set(),
};

function toNum(v){ const n = Number(String(v).replace(',', '.')); return Number.isFinite(n) ? n : null; }
function uniq(values){ return [...new Set(values.filter(v => v!==undefined && v!==null && String(v).trim()!==''))]; }
function sortAlpha(a,b){ return String(a).localeCompare(String(b), 'ru', {numeric:true}); }

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –º–∞–Ω—ã –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
function sortMana(a, b) {
  const order = ['–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ', '–ú–µ–¥–ª–µ–Ω–Ω–æ', '–°—Ä–µ–¥–Ω–µ', '–ë—ã—Å—Ç—Ä–æ', '–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ', '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ –±—ã—Å—Ç—Ä–æ'];
  const indexA = order.indexOf(a);
  const indexB = order.indexOf(b);
  
  if (indexA === -1 && indexB === -1) return String(a).localeCompare(String(b), 'ru');
  if (indexA === -1) return 1;
  if (indexB === -1) return -1;
  
  return indexA - indexB;
}

function sortNumericAsc(a,b){ const na=toNum(a), nb=toNum(b); return (na??Infinity) - (nb??Infinity); }

function fileCellToUrl(v){
  if (!v) return '';
  const s = String(v).trim();
  const mParen = s.match(/\((https?:\/\/[^)]+)\)/i);
  if (mParen) return mParen[1];
  const mAny = s.match(/https?:\/\/\S+/i);
  if (mAny) return mAny[0].replace(/[),]+$/,'');
  try {
    const arr = JSON.parse(s);
    if (Array.isArray(arr) && arr.length && arr[0].url) return arr[0].url;
  } catch(e){}
  return '';
}

function buildFacet(container, values, facetKey){
  let opts = uniq(values);
  
  // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –º–∞–Ω—ã
  if (facetKey === 'mana') {
    opts.sort(sortMana);
  } else if (facetKey === 'stars') {
    opts.sort(sortNumericAsc);
  } else {
    opts.sort(sortAlpha);
  }
  
  container.innerHTML = opts.map(val => {
    const checked = selected[facetKey].size ? (selected[facetKey].has(String(val)) ? 'checked' : '') : '';
    return `<label class="opt"><input type="checkbox" data-facet="${facetKey}" value="${String(val).replace(/"/g,'&quot;')}" ${checked}><span>${String(val)}</span></label>`;
  }).join('');
  
  container.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
    cb.addEventListener('change', ()=>{
      const set = selected[facetKey];
      if (cb.checked) set.add(cb.value); else set.delete(cb.value);
      applyFilters();
    });
  });
}

function initAllFacets(rows){
  buildFacet(els.facet.element, rows.map(r=>r[F.element]), 'element');
  buildFacet(els.facet.stars,   rows.map(r=>r[F.stars]),   'stars');
  buildFacet(els.facet.mana,    rows.map(r=>r[F.mana]),    'mana');
  buildFacet(els.facet.attackType, rows.map(r=>r[F.attackType]), 'attackType');
  buildFacet(els.facet.summon,  rows.map(r=>r[F.summon]),  'summon');
  buildFacet(els.facet.clazz,   rows.map(r=>r[F.clazz]),   'clazz');
}

function selectAll(facetKey){
  const values = uniq(allRows.map(r=>{
    switch(facetKey){
      case 'element': return r[F.element];
      case 'stars': return r[F.stars];
      case 'mana': return r[F.mana];
      case 'attackType': return r[F.attackType];
      case 'summon': return r[F.summon];
      case 'clazz': return r[F.clazz];
    }
  }));
  selected[facetKey] = new Set(values.map(String));
  initAllFacets(allRows);
  applyFilters();
}

function selectNone(facetKey){
  selected[facetKey].clear();
  initAllFacets(allRows);
  applyFilters();
}

function renderCards(rows){
  if (!rows.length){
    els.cards.innerHTML = '';
    els.empty.style.display = 'block';
    return;
  }
  els.empty.style.display = 'none';
  els.cards.innerHTML = rows.map((r, i)=>{
    const img = fileCellToUrl(r[F.image]);
    const abilitiesOneLine = String(r[F.abilities]||'').split(/\r?\n/).filter(Boolean)[0] || '';
    const abilitiesShort = abilitiesOneLine.length > 50 ? abilitiesOneLine.substring(0, 50) + '...' : abilitiesOneLine;
    
    return `
      <article class="card" data-idx="${i}">
        <div class="thumb">
          ${img ? `<img src="${img}" alt="${r[F.name]||''}" loading="lazy" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div style=\\'color: #999; padding: 20px; text-align: center;\\'>–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';" />` : '<div style="color: #999; padding: 20px; text-align: center;">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>'}
        </div>
        <h3>${r[F.name]||''}</h3>
        <div class="meta">
          <span>${r[F.element]||''}</span> ‚Ä¢
          <span>${r[F.stars]||''}‚òÖ</span> ‚Ä¢
          <span>${r[F.mana]||''}</span>
        </div>
        <div class="meta">
          <span>${r[F.attackType]||''}</span> ‚Ä¢
          <span>${r[F.summon]||''}</span> ‚Ä¢
          <span>${r[F.clazz]||''}</span>
        </div>
        <div class="stats">
          <span class="pill">–°: ${r[F.power]||''}</span>
          <span class="pill">–ê: ${r[F.attack]||''}</span>
          <span class="pill">–ó: ${r[F.defense]||''}</span>
          <span class="pill">–ñ: ${r[F.hp]||''}</span>
        </div>
        ${abilitiesOneLine ? `<div class="meta" style="font-size: 11px; color: #666; padding: 0 8px 8px;" title="${String(r[F.abilities]).replace(/"/g,'&quot;')}">${abilitiesShort}</div>` : ''}
      </article>
    `;
  }).join('');
}

function fillModal(h){
  const img = fileCellToUrl(h[F.image]);
  els.mImg.src = img || '';
  els.mImg.alt = h[F.name] || '';
  els.mOpenImg.href = img || '#';
  els.mOpenImg.style.display = img ? 'inline-block' : 'none';

  els.mName.textContent = h[F.name] || '';
  els.mMeta1.innerHTML = `
    <span>${h[F.element]||''}</span>
    <span>${(h[F.stars]||'') ? (h[F.stars]+'‚òÖ') : ''}</span>
    <span>${h[F.mana]||''}</span>
  `;
  els.mMeta2.innerHTML = `
    <span>${h[F.attackType]||''}</span>
    <span>${h[F.summon]||''}</span>
    <span>${h[F.clazz]||''}</span>
  `;
  els.mStats.innerHTML = `
    <span class="pill">–°–∏–ª–∞: ${h[F.power]||''}</span>
    <span class="pill">–ê–¢–ö: ${h[F.attack]||''}</span>
    <span class="pill">–ó–ê–©: ${h[F.defense]||''}</span>
    <span class="pill">HP: ${h[F.hp]||''}</span>
  `;
  els.mAbilities.textContent = h[F.abilities] || '‚Äî';
  els.mPassive.textContent = h[F.passive] || '‚Äî';

  const order = [
    ['ID', F.id],
    ['–ì–µ—Ä–æ–π', F.name],
    ['–°—Ç–∏—Ö–∏—è', F.element],
    ['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥', F.stars],
    ['–°–∫–æ—Ä–æ—Å—Ç—å –º–∞–Ω—ã', F.mana],
    ['–°–∏–ª–∞', F.power],
    ['–ê—Ç–∞–∫–∞', F.attack],
    ['–ó–∞—â–∏—Ç–∞', F.defense],
    ['–ñ–∏–∑–Ω–∏', F.hp],
    ['–°–ø–æ—Å–æ–± –∞—Ç–∞–∫–∏', F.attackType],
    ['–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏', F.abilities],
    ['–ü–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏', F.passive],
    ['–ú–µ—Å—Ç–æ –ø—Ä–∏–∑—ã–≤–∞', F.summon],
    ['–ö–ª–∞—Å—Å', F.clazz],
    ['–ö–∞—Ä—Ç–∏–Ω–∫–∞ (URL)', F.image],
  ];
  els.mAllFields.innerHTML = order.map(([label, key])=>{
    let val = h[key];
    if (key === F.image) val = fileCellToUrl(val) || '';
    return `<tr><th>${label}</th><td>${val ? String(val).replace(/\n/g,'<br>') : '‚Äî'}</td></tr>`;
  }).join('');
}

function openModal(idx){
  if (!viewRows.length) return;
  currentIdx = idx;
  fillModal(viewRows[currentIdx]);
  els.modal.classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeModal(){
  els.modal.classList.remove('show');
  document.body.style.overflow = '';
  currentIdx = -1;
}

function go(delta){
  if (currentIdx < 0 || !viewRows.length) return;
  currentIdx = (currentIdx + delta + viewRows.length) % viewRows.length;
  fillModal(viewRows[currentIdx]);
}

function applyFilters(){
  const q = els.q.value.trim().toLowerCase();
  viewRows = allRows.filter(r=>{
    const tName = String(r[F.name]||'').toLowerCase();
    const tAbil = String(r[F.abilities]||'').toLowerCase();
    const passQ = !q || tName.includes(q) || tAbil.includes(q);
    const passElem   = selected.element.size===0   || selected.element.has(String(r[F.element]));
    const passStars  = selected.stars.size===0     || selected.stars.has(String(r[F.stars]));
    const passMana   = selected.mana.size===0      || selected.mana.has(String(r[F.mana]));
    const passAtkT   = selected.attackType.size===0|| selected.attackType.has(String(r[F.attackType]));
    const passSummon = selected.summon.size===0    || selected.summon.has(String(r[F.summon]));
    const passClazz  = selected.clazz.size===0     || selected.clazz.has(String(r[F.clazz]));
    return passQ && passElem && passStars && passMana && passAtkT && passSummon && passClazz;
  });

  const by = els.sortBy.value;
  const dir = els.sortDir.value;
  viewRows.sort((a,b)=>{
    const av = a[by], bv = b[by];
    const an = toNum(av), bn = toNum(bv);
    let cmp;
    if (an!=null && bn!=null) cmp = an - bn;
    else cmp = String(av||'').localeCompare(String(bv||''), 'ru', {numeric:true});
    return dir==='asc' ? cmp : -cmp;
  });

  els.count.textContent = `–ù–∞–π–¥–µ–Ω–æ: ${viewRows.length}`;
  renderCards(viewRows);
}

function attachEvents(){
  [els.q, els.sortBy, els.sortDir].forEach(el=>{
    el.addEventListener('input', applyFilters);
    el.addEventListener('change', applyFilters);
  });
  
  document.querySelectorAll('.facet .actions button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const facetKey = btn.dataset.facet;
      if (btn.dataset.action === 'all') selectAll(facetKey);
      else selectNone(facetKey);
    });
  });
  
  els.resetAll.addEventListener('click', ()=>{
    els.q.value = '';
    els.sortBy.value = '–°–∏–ª–∞';
    els.sortDir.value = 'desc';
    Object.keys(selected).forEach(k => selected[k].clear());
    initAllFacets(allRows);
    applyFilters();
  });
  
  els.cards.addEventListener('click', (e)=>{
    const card = e.target.closest('.card');
    if (!card) return;
    const idx = Number(card.dataset.idx);
    if (Number.isFinite(idx)) openModal(idx);
  });
  
  els.mClose.addEventListener('click', closeModal);
  els.mPrev.addEventListener('click', ()=>go(-1));
  els.mNext.addEventListener('click', ()=>go(1));
  
  els.modal.addEventListener('click', (e)=>{
    if (e.target === els.modal) closeModal();
  });
  
  window.addEventListener('keydown', (e)=>{
    if (!els.modal.classList.contains('show')) return;
    if (e.key === 'Escape') closeModal();
    if (e.key === 'ArrowLeft') go(-1);
    if (e.key === 'ArrowRight') go(1);
  });
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ - —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
  els.openFilters.addEventListener('click', ()=>{
    els.filters.classList.add('show');
    els.filters.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  });
  
  els.closeFilters.addEventListener('click', ()=>{
    els.filters.classList.remove('show');
    els.filters.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
  });
  
  // –ö–ª–∏–∫ –ø–æ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã
  els.filters.addEventListener('click', (e)=>{
    if (e.target === els.filters) {
      els.filters.classList.remove('show');
      els.filters.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
  });
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–∞–ª–∫–∞
  els.infoBtn.addEventListener('click', ()=>{
    els.infoModal.classList.add('show');
    document.body.style.overflow = 'hidden';
  });
  
  els.infoClose.addEventListener('click', ()=>{
    els.infoModal.classList.remove('show');
    document.body.style.overflow = '';
  });
  
  els.infoModal.addEventListener('click', (e)=>{
    if (e.target === els.infoModal) {
      els.infoModal.classList.remove('show');
      document.body.style.overflow = '';
    }
  });
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  const now = new Date();
  const options = { year: 'numeric', month: 'long', day: 'numeric' };
  els.updateDate.textContent = now.toLocaleDateString('ru-RU', options);
}

Papa.parse(DATA_URL, {
  download:true,
  header:true,
  skipEmptyLines:true,
  complete: (res)=>{
    allRows = res.data || [];
    if (!allRows.length){ 
      els.count.textContent = '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ heroes.csv'; 
      return; 
    }
    initAllFacets(allRows);
    attachEvents();
    applyFilters();
  },
  error: (e)=> { 
    console.error('–û—à–∏–±–∫–∞ CSV:', e); 
    els.count.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV.'; 
  }
});
</script>
</body>
</html>

